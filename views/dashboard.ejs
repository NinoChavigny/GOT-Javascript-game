
<%- include('header') -%>


<div class="text-center container w-25 border border-0 top-100 start-50 tertiary-bg" id="welcome">
    <h3>Welcome to Express Dashboard</h3>
    <h5><%= locals.user ? user : "User" %></h5>
    <a href="/route/logout">Logout</a>
</div>

<div class="text-center container w-25 border" id="rooms">
    <h3>All Games</h3>

    <table class="table" id="table1">
      
        
    </table>
    <h5></h5>
</div>

<div class="text-center container w-25 border" id="user-rooms">
    <h3>Your Games</h3>
    <table class="table" id="table2">
      
        
    </table>
    <h5></h5>
</div>







<script>
const ws = new WebSocket("ws://localhost:3000");
var uid = JSON.parse('<%- JSON.stringify(uid) %>');

ws.onopen = function() {
  ws.send('Hello server');

}

ws.onmessage = function(event) {
  let tableData = document.getElementById("table1");
  let tableData2 = document.getElementById("table2");



  let data = JSON.parse(event.data);
  let data2 = JSON.parse(event.data);
  let test = 0;

  for(i = 0; i < data.length; i++){
    for(j = 0; j < JSON.parse(data[i]['room_members_id']).length; j++){
      if(uid == JSON.parse(data[i]['room_members_id'])[j])
      {
        test = 1;
      }
    }
    if(test == 1){
      delete data[i];
    }
    else{
      if(test == 0)
      {
        delete data2[i];
      }
  }}

  console.log(data);
  console.log(data2);
  ///console.log(data);

  //set header of table


let table = `
  <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Name</th>
      <th scope="col">Members</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
  `;
  //create//append rows
for(i = 0; i < data.length; i++){
  if(data[i] != null){
    table = table +
    `<tr>
      <th scope="row">${data[i]['room_id']}</th>
      <td>${data[i]['room_name']}</td>
      <td>${JSON.parse(data[i]['room_members_id']).length}/4</td>
      <td><button type="submit" onclick="myFunction(this, ${uid})" id="${data[i]['room_id']}" class="btn btn-success rounded-pill">Join</button></td>
    </tr>`
}}
//close off table
table = table +
  `</tbody>`
  ;







  let table2 = `
  <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Name</th>
      <th scope="col">Members</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
  `;
  //create//append rows
for(j = 0; j < data2.length; j++){
  if(data2[j] != null){
    table2 = table2 +
    `<tr>
      <th scope="row">${data2[j]['room_id']}</th>
      <td>${data2[j]['room_name']}</td>
      <td>${JSON.parse(data2[j]['room_members_id']).length}/4</td>
      <td><button type="submit" onclick="" id="${data2[j]['room_id']}" class="btn btn-success rounded-pill">View</button></td>
    </tr>`
}}
//close off table
table2 = table2 +
  `</tbody>`
  ;


tableData.innerHTML = table;
tableData2.innerHTML = table2;
  

};

///var test = document.getElementById("bouton1");


function myFunction(element, uid) {
  console.log(element.id, uid);

  ws.send(JSON.stringify(`["join","${element.id}", "${uid}"]`));
}

</script>


<%- include('footer') -%>